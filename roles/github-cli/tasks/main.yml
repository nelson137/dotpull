- when: ansible_os_family == 'Debian'
  vars:
    _arch_map:
      aarch64: arm64
      armv6l: armhf
      armv7l: armhf
      i386: i386
      x86_64: amd64
    ghcli_keyring_path: /etc/apt/keyrings/githubcli-archive-keyring.gpg
  block:

    - name: Download the GitHub CLI signing key
      become: true
      get_url:
        url: https://cli.github.com/packages/githubcli-archive-keyring.gpg
        dest: '{{ ghcli_keyring_path }}'
        mode: '0644'

    - name: Install the APT source
      become: true
      template: src=github-cli.list.j2 dest=/etc/apt/sources.list.d/github-cli.list
      vars:
        deb_arch: '{{ _arch_map[ansible_architecture] }}'
        deb_keyring: '{{ ghcli_keyring_path }}'

    - name: Install GitHub CLI
      become: true
      apt: name=gh state=latest update_cache=true
