- name: Install zsh
  apt: name=zsh state=latest

- name: Oh My Zsh
  vars:
    install_script: /tmp/install-ohmyzsh
  block:

    - name: Download install script
      get_url:
        url: https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh
        dest: "{{ install_script }}"
        mode: 0755

    - name: Execute install script
      command:
        cmd: "{{ install_script }} --unattended"
        creates: "{{ ansible_user_dir }}/.oh-my-zsh"

    - name: Remove install script
      file:
        path: "{{ install_script }}"
        state: absent

- name: Change user shell to zsh
  become: yes
  user:
    name: "{{ ansible_user }}"
    shell: /usr/bin/zsh
